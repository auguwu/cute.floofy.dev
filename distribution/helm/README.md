# üêª‚Äç‚ùÑÔ∏èüíê ume :: Helm Chart
This is the official [Helm](https://helm.sh) chart for Noel's [`ume`](https://floofy.dev/oss/ume) made in Rust.

## Requirements
- Kubernetes 1.26 or higher
- Helm 3.12 or higher

## Installation
```shell
$ helm repo add https://charts.noelware.org/~/noel
$ helm install ume noel/ume
```

## Parameters

### Global Parameters

Contains any global parameters that will affected all objects in the `ume` Helm chart.

| Name                              | Description                                                                                                                                                                                              | Value           |
| --------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------- |
| `global.replicas`                 | Amount of replicas to spawn                                                                                                                                                                              | `1`             |
| `global.resources`                | Resource list to apply to all containers.                                                                                                                                                                | `{}`            |
| `global.fullNameOverride`         | String to fully override the Helm installation name for all objects                                                                                                                                      | `""`            |
| `global.nameOverride`             | String to override the Helm installation name for all objects, will be in conjunction with a prefix of `<install-name>-`                                                                                 | `""`            |
| `global.clusterDomain`            | Domain host that maps to the cluster                                                                                                                                                                     | `cluster.local` |
| `global.nodeSelector`             | Selector labels to apply to contraint the pods to specific nodes. Read more in the [Kubernetes documentation](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector).    | `{}`            |
| `global.tolerations`              | List of all taints/tolerations to apply in conjunction with `global.affinity`. Read more in the [Kubernetes documentation](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration) | `[]`            |
| `global.affinity`                 | Map of all the affinity to apply to the spawned Pods. Read more in the [Kubernetes documentation](https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes-using-node-affinity/).      | `{}`            |
| `global.annotations`              | Map of annotations to append to on all objects that this Helm chart creates.                                                                                                                             | `{}`            |
| `global.extraEnvVars`             | List of extra environment variables to append to all init/sidecar containers and normal containers.                                                                                                      | `[]`            |
| `global.initContainers`           | List of init containers to create.                                                                                                                                                                       | `[]`            |
| `global.podSecurityContext`       | Security context for all spawned Pods. Read more in the [Kubernetes documentation](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/).                                          | `{}`            |
| `global.containerSecurityContext` | Security context for all init, sidecar, and normal containers. Read more in the [Kubernetes documentation](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/).                  | `{}`            |

### Docker Image Parameters

Parameters to modify the Docker image that is ran.

| Name               | Description                                                                                                     | Value        |
| ------------------ | --------------------------------------------------------------------------------------------------------------- | ------------ |
| `image.pullPolicy` | [Pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy) when pulling the image. | `""`         |
| `image.registry`   | Registry URL to point to. For Docker Hub, use an empty string.                                                  | `""`         |
| `image.image`      | Image name.                                                                                                     | `auguwu/ume` |
| `image.tag`        | The tag of the image. Keep this as a empty string if you wish to use the default app's version.                 | `""`         |
| `image.digest`     | Digest in the form of `<alg>:<hex>`, this will replace the `image.tag` property if this is not empty.           | `""`         |

### Service Account Parameters

| Name                         | Description                                                                                | Value  |
| ---------------------------- | ------------------------------------------------------------------------------------------ | ------ |
| `serviceAccount.create`      | Whether or not if the service account should be created for this Helm installation.        | `true` |
| `serviceAccount.annotations` | Any additional annotations to append to this ServiceAccount                                | `{}`   |
| `serviceAccount.name`        | The name of the service account, this will be the Helm installation name if this is empty. | `""`   |

### Service Parameters

| Name                   | Description                                                                        | Value       |
| ---------------------- | ---------------------------------------------------------------------------------- | ----------- |
| `service.enabled`      | whether or not to create a [Service] object.                                       | `true`      |
| `service.type`         | What type of service is this?                                                      | `ClusterIP` |
| `service.labels`       | Map of labels to append to                                                         | `{}`        |
| `service.annotations`  | Map of annotations to append to                                                    | `{}`        |
| `service.selector`     | Service selector to select pods                                                    | `{}`        |
| `service.clusterIP`    | sets the cluster IP if `service.type` is ClusterIP                                 | `""`        |
| `service.loadBalancer` | Load balancer configuration if `service.type` is LoadBalancer                      | `{}`        |
| `service.externalName` | External name if `service.type` is ExternalName                                    | `""`        |
| `service.ports.http`   | If you edited the port to use for the Ume server, this is where you should set it. | `3621`      |

### Ingress Parameters

| Name                  | Description                                                                                             | Value                    |
| --------------------- | ------------------------------------------------------------------------------------------------------- | ------------------------ |
| `ingress.enabled`     | whether or not if Ingress is enabled                                                                    | `false`                  |
| `ingress.className`   | Class name for the ingress                                                                              | `""`                     |
| `ingress.apiVersion`  | API version of the Ingress if it wasn't auto-detected                                                   | `""`                     |
| `ingress.hostname`    | Host name of the Ume server                                                                             | `ume.local`              |
| `ingress.path`        | Path to point to when connecting to the Ume server                                                      | `/`                      |
| `ingress.pathType`    | the [Type of path](https://kubernetes.io/docs/concepts/services-networking/ingress/#path-types) to use. | `ImplementationSpecific` |
| `ingress.servicePort` | Port to the Ume service                                                                                 | `http`                   |
| `ingress.tls`         | whether or not if TLS is enabled on the Ingress                                                         | `false`                  |
| `ingress.selfSigned`  | whether or not if the Ingress record should create a self-signed TLS record that Helm will generate     | `false`                  |
| `ingress.extraHosts`  | List of extra hosts to append                                                                           | `[]`                     |
| `ingress.extraRules`  | List of extra rules to append                                                                           | `[]`                     |
| `ingress.extraTls`    | List of extra TLS certificates to append                                                                | `[]`                     |

### Configuration

| Name                                  | Description                                                                                                                                           | Value                            |
| ------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------- |
| `config.mapName`                      | The name of the [ConfigMap](https://kubernetes.io/docs/concepts/configuration/configmap) that will be generated.                                      | `config`                         |
| `config.sentryDsn`                    | Sentry [DSN](https://docs.sentry.io/product/sentry-basics/concepts/dsn-explainer) to connect to, which will report all errors to that Sentry project. | `""`                             |
| `config.uploaderKey.value`            | The value of the uploader key, this can be intepreted as a Helm template.                                                                             | `{{ randAlphaNum 32 }}`          |
| `config.uploaderKey.existingSecret`   | If the uploader key already exists, then this will be the secret name that the uploader key will be generated from                                    | `""`                             |
| `config.uploaderKey.key`              | The key name to lookup the uploader key in that secret.                                                                                               | `ume-uploader-key`               |
| `config.logging.logstashTcpUrl`       | TCP-based server URI to connect to, which will report all errors to. This can be dangerous if `config.logging.level` is `debug` or higher.            | `""`                             |
| `config.logging.level`                | Log level to use when showing logs in the terminal. Highest is TRACE and lowest is ERROR                                                              | `info`                           |
| `config.logging.json`                 | Reports all logs in the terminal as JSON input. This follows Noelware's Log Output Schema.                                                            | `false`                          |
| `config.tracing.enabled`              | Enables tracing via Sentry or OpenTelemetry                                                                                                           | `false`                          |
| `config.tracing.backend`              | Sets what backend to use, `sentry` and `opentelemetry`/`otel` is the only values you can use.                                                         | `""`                             |
| `config.tracing.sentry.sampleSet`     | The sample set as a float from 0.0 to 1.0 to trace all samples as.                                                                                    | `0.5`                            |
| `config.tracing.opentelemetry.labels` | Extra labels to report. This will include the `service.name` as `ume` and the `ume.version` to the version of Ume you're running.                     | `{}`                             |
| `config.tracing.opentelemetry.kind`   | Kind of endpoint we should use, `grpc` and `http` are the only accepted values.                                                                       | `grpc`                           |
| `config.tracing.opentelemetry.url`    | URL to a OpenTelemetry Collector instance                                                                                                             | `grpc://localhost:4318`          |
| `config.server.host`                  | Host to bind to when creating the Ume server                                                                                                          | `0.0.0.0`                        |
| `config.server.port`                  | Port to bind to, this will create the `http` port in the container.                                                                                   | `3621`                           |
| `config.server.ssl.enabled`           | whether or not to enable SSL                                                                                                                          | `false`                          |
| `config.server.ssl.caPath`            | Path to a certificate where the Ume server will use.                                                                                                  | `/app/noel/ume/certs/server.pem` |
| `config.server.ssl.keyPath`           | Path to a certificate key where the Ume server will use                                                                                               | `/app/noel/ume/certs/server.key` |

### Storage Parameters

Configures the storage to host all files in. This will configure the [`storage`](https://floofy.dev/docs/ume/latest/self-hosting/configuration#storage-block)
in the `ume.hcl` configuration file.

| Name                                                                 | Description                                                                                                                                                                                                                             | Value                           |
| -------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------- |
| `storage.filesystem.directory`                                       | The directory that will be mounted onto the container.                                                                                                                                                                                  | `/var/lib/noel/ume/data`        |
| `storage.filesystem.persistence.enabled`                             | whether or not to persist the filesystem (`storage.filesystem.directory`) as a [PersistentVolumeClaim](https://kubernetes.io/docs/concepts/storage/persistent-volumes).                                                                 | `true`                          |
| `storage.filesystem.persistence.storageClassName`                    | choses which storage class the cluster should provision the PVC as, this is usually not included to use the default storage class configured by the cluster.                                                                            | `""`                            |
| `storage.filesystem.persistence.annotations`                         | Map of [annotations](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/) to append to the PVC                                                                                                               | `{}`                            |
| `storage.filesystem.persistence.labels`                              | Map of [labels](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels) to append to the PVC                                                                                                                          | `{}`                            |
| `storage.filesystem.persistence.accessModes`                         | List of allowed ways to interact with the PVC when it is mounted. The default is recommended, but you can read the [docs](https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes) for what options are available. | `["ReadWriteOnce"]`             |
| `storage.filesystem.persistence.size`                                | How large the PVC should be                                                                                                                                                                                                             | `8GiB`                          |
| `storage.filesystem.persistence.selector`                            | Any additional selectors that the PVC needs                                                                                                                                                                                             | `{}`                            |
| `storage.s3.enabled`                                                 | Enables the use of Amazon S3, this will use the [`storage "s3" {}`](https://floofy.dev/docs/ume/latest/self-hosting/configuration#storage-s3-block) block.                                                                              | `false`                         |
| `storage.s3.enableSignerV4Requests`                                  | Whether if the S3 storage backend should enable AWSv4 signatures when requests come in or not.                                                                                                                                          | `false`                         |
| `storage.s3.enforcePathAccessStyle`                                  | Whether or not to use domain-style paths or the new path style. (`false` = `{bucket}.{host}`; `true` = `{host}/{bucket}`)                                                                                                               | `false`                         |
| `storage.s3.defaultObjectAcl`                                        | Default canned ACL for all published objects                                                                                                                                                                                            | `bucket-owner-full-control`     |
| `storage.s3.defaultBucketAcl`                                        | Default bucket ACL when the [`storage.s3.bucket`](https://floofy.dev/docs/ume/latest/self-hosting/configuration#storage-s3-bucket) is not available on the account.                                                                     | `private`                       |
| `storage.s3.appName`                                                 | Application name.                                                                                                                                                                                                                       | `Noel/ume`                      |
| `storage.s3.prefix`                                                  | Selector prefix to use when looking up artifacts with the `GET /images/{id}` endpoint, this is useful if you have a filesystem-like architecture for your buckets.                                                                      | `nil`                           |
| `storage.s3.region`                                                  | AWS region where the bucket resides in.                                                                                                                                                                                                 | `us-east-1`                     |
| `storage.s3.bucket`                                                  | The bucket itself, it'll default to `ume`.                                                                                                                                                                                              | `ume`                           |
| `storage.s3.secrets.accessKeyId.secret`                              | The actual secret that will be created as a Kubernetes secret.                                                                                                                                                                          | `""`                            |
| `storage.s3.secrets.accessKeyId.existingSecret`                      | If an existing secret already exists, this is where you put it in instead of creating one.                                                                                                                                              | `""`                            |
| `storage.s3.secrets.accessKeyId.secretKeyName`                       | The name of the secret to find the access key ID.                                                                                                                                                                                       | `access-key-id`                 |
| `storage.s3.secrets.secretAccessKey.secret`                          |                                                                                                                                                                                                                                         | `""`                            |
| `storage.s3.secrets.secretAccessKey.existingSecret`                  |                                                                                                                                                                                                                                         | `""`                            |
| `storage.s3.secrets.secretAccessKey.secretKeyName`                   |                                                                                                                                                                                                                                         | `secret-access-key`             |
| `storage.azure.enabled`                                              |                                                                                                                                                                                                                                         | `false`                         |
| `storage.azure.container`                                            |                                                                                                                                                                                                                                         | `ume`                           |
| `storage.azure.credential.kind`                                      |                                                                                                                                                                                                                                         | `anonymous`                     |
| `storage.azure.credential.sasToken.secret`                           |                                                                                                                                                                                                                                         | `""`                            |
| `storage.azure.credential.sasToken.existingSecret`                   |                                                                                                                                                                                                                                         | `""`                            |
| `storage.azure.credential.sasToken.secretKeyName`                    |                                                                                                                                                                                                                                         | `azure-sas-token`               |
| `storage.azure.credential.bearer.secret`                             |                                                                                                                                                                                                                                         | `""`                            |
| `storage.azure.credential.bearer.existingSecret`                     |                                                                                                                                                                                                                                         | `""`                            |
| `storage.azure.credential.bearer.secretKeyName`                      |                                                                                                                                                                                                                                         | `azure-sas-token`               |
| `storage.azure.credential.accessKey.accountId`                       |                                                                                                                                                                                                                                         | `""`                            |
| `storage.azure.credential.accessKey.accessKey.secret`                |                                                                                                                                                                                                                                         | `""`                            |
| `storage.azure.credential.accessKey.accessKey.existingSecret`        |                                                                                                                                                                                                                                         | `""`                            |
| `storage.azure.credential.accessKey.accessKey.secretKeyName`         |                                                                                                                                                                                                                                         | `account-access-key`            |
| `storage.azure.location.kind`                                        |                                                                                                                                                                                                                                         | `public`                        |
| `storage.azure.location.public.accountId`                            |                                                                                                                                                                                                                                         | `""`                            |
| `storage.azure.location.china.accountId`                             |                                                                                                                                                                                                                                         | `""`                            |
| `storage.azure.location.emulator.address`                            |                                                                                                                                                                                                                                         | `""`                            |
| `storage.azure.location.emulator.port`                               |                                                                                                                                                                                                                                         | `10000`                         |
| `storage.gridfs.enabled`                                             |                                                                                                                                                                                                                                         | `false`                         |
| `storage.gridfs.selectionCriteria`                                   |                                                                                                                                                                                                                                         | `nil`                           |
| `storage.gridfs.writeConcern`                                        |                                                                                                                                                                                                                                         | `nil`                           |
| `storage.gridfs.readConcern`                                         |                                                                                                                                                                                                                                         | `nil`                           |
| `storage.gridfs.chunkSize`                                           |                                                                                                                                                                                                                                         | `261120`                        |
| `storage.gridfs.database`                                            |                                                                                                                                                                                                                                         | `ume`                           |
| `storage.gridfs.bucket`                                              |                                                                                                                                                                                                                                         | `ume`                           |
| `storage.gridfs.clientOptions.hosts`                                 |                                                                                                                                                                                                                                         | `["mongodb://localhost:27017"]` |
| `storage.gridfs.clientOptions.appName`                               |                                                                                                                                                                                                                                         | `Noel/ume`                      |
| `storage.gridfs.clientOptions.directConnection`                      |                                                                                                                                                                                                                                         | `false`                         |
| `storage.gridfs.clientOptions.connectTimeout`                        |                                                                                                                                                                                                                                         | `10000`                         |
| `storage.gridfs.clientOptions.credential.kind`                       |                                                                                                                                                                                                                                         | `anonymous`                     |
| `storage.gridfs.clientOptions.credential.userPass.username`          |                                                                                                                                                                                                                                         | `""`                            |
| `storage.gridfs.clientOptions.credential.userPass.password`          |                                                                                                                                                                                                                                         | `""`                            |
| `storage.gridfs.clientOptions.credential.userPass.existingSecret`    |                                                                                                                                                                                                                                         | `""`                            |
| `storage.gridfs.clientOptions.credential.userPass.usernameSecretKey` |                                                                                                                                                                                                                                         | `gridfs-username`               |
| `storage.gridfs.clientOptions.credential.userPass.passwordSecretKey` |                                                                                                                                                                                                                                         | `gridfs-password`               |
| `storage.gridfs.clientOptions.credential.mechanism`                  |                                                                                                                                                                                                                                         | `""`                            |
| `storage.gridfs.clientOptions.credential.mechanismProperties`        |                                                                                                                                                                                                                                         | `{}`                            |
| `storage.gridfs.clientOptions.heartbeatFrequency`                    |                                                                                                                                                                                                                                         | `10000`                         |
| `storage.gridfs.clientOptions.loadBalanced`                          |                                                                                                                                                                                                                                         | `false`                         |
| `storage.gridfs.clientOptions.localThreshold`                        |                                                                                                                                                                                                                                         | `15`                            |
| `storage.gridfs.clientOptions.maxIdleTime`                           |                                                                                                                                                                                                                                         | `nil`                           |
| `storage.gridfs.clientOptions.maxPoolSize`                           |                                                                                                                                                                                                                                         | `10`                            |
| `storage.gridfs.clientOptions.minPoolSize`                           |                                                                                                                                                                                                                                         | `1`                             |
| `storage.gridfs.clientOptions.maxConnecting`                         |                                                                                                                                                                                                                                         | `2`                             |
| `storage.gridfs.clientOptions.retryReads`                            |                                                                                                                                                                                                                                         | `true`                          |
| `storage.gridfs.clientOptions.retryWrites`                           |                                                                                                                                                                                                                                         | `false`                         |
| `storage.gridfs.clientOptions.serverSelectionTimeout`                |                                                                                                                                                                                                                                         | `30000`                         |
| `storage.gridfs.clientOptions.srvMaxHosts`                           |                                                                                                                                                                                                                                         | `3`                             |
| `storage.gridfs.clientOptions.tls.enabled`                           |                                                                                                                                                                                                                                         | `false`                         |
| `storage.gridfs.clientOptions.tls.allowInvalidCertificates`          |                                                                                                                                                                                                                                         | `false`                         |
| `storage.gridfs.clientOptions.tls.caFilePath`                        |                                                                                                                                                                                                                                         | `/app/noel/ume/certs/cert.ca`   |
| `storage.gridfs.clientOptions.tls.certKeyFilePath`                   |                                                                                                                                                                                                                                         | `/app/noel/ume/certs/cert.key`  |
| `storage.gridfs.clientOptions.tls.allowInvalidHostnames`             |                                                                                                                                                                                                                                         | `false`                         |
